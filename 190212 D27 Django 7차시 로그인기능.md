ë¡œê·¸ì¸ ê¸°ëŠ¥

`auth` í´ë”

`accounts` ë¼ëŠ” ì•±



### accounts-urls.py  <span style="color:blue">&</span> accounts-templates-signup.html

1. <h2>íšŒì›ê°€ì… í˜ì´ì§€</h2>

```python
# urls.py
from django.urls import path
from . import views

app_name = 'accounts'
urlpatterns = [ path('signup/', views.signup, name='signup'),    ]
```

```python
# views.py
from django.shortcuts import render, redirect
from django.contrib.auth.forms import UserCreationForm   # ì¥ê³ ê°€ ë§Œë“¤ì–´ë†“ì€ íšŒì›ê°€ì… í¼ì´ ìˆëŠ”ë°, ê·¸ê±° ê·¸ëŒ€ë¡œ ì‚¬ìš©
# Create your views here.

# íšŒì›ê°€ì… í¼ì´ ìˆëŠ” í˜ì´ì§€
def signup(request):
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            return redirect('posts:list')
        
    else:
        form = UserCreationForm()
            
    return render(request,'signup.html', {'form': form} )
```

```html
<!-- signup.html -->

{% extends 'base.html' %}

{% block container %}

<h1>íšŒì›ê°€ì…</h1>

<form method="post">
    {% csrf_token %}
    {{ form }}
    <input type="submit" value="Submit"/>
</form>
{% endblock %}
```



2. ë¡œê·¸ì¸ í˜ì´ì§€ ë§Œë“¤ê¸°

   ```python
   # urls.py
   
   from django.urls import path
   from . import views
   
   app_name = 'accounts'
   
   urlpatterns = [
       path('signup/', views.signup, name='signup'),
       path('login/', views.login, name='login'),
    ]
   ```

   ```python
   # views.py
   
   from django.shortcuts import render, redirect
   from django.contrib.auth.forms import UserCreationForm, AuthenticationForm      : ğŸ‘€ # import í•  ê±° í™•ì¸
   from django.contrib.auth import login as auth_login   : ğŸ‘€ # ì´ê²ƒë„
       
   # ë¡œê·¸ì¸ ê¸°ëŠ¥ :   session ì„ create   / session delete = log out
       # session : ì´ í˜ì´ì§€ì— ì ‘ê·¼í•˜ëŠ” ê²Œ ëˆ„êµ¬ì¸ì§€ ì„ì‹œë¡œ ì €ì¥í•˜ê³  ìˆëŠ” ê³µê°„ (ex. ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤)
                   # í˜ì´ì§€ë¥¼ ì´ë™í•´ë„, session ì´ ìœ ì§€ë˜ê³  ìˆë‹¤ë©´, user ëŠ” ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤ (ex. í˜ì´ì§€ ì˜®ê²¨ë„ ë¡œê·¸ì¸ ìœ ì§€)
           
           
           =================================================================================
       
   def login(request):
       if request.method == 'POST' :
           form = AuthenticationForm(request, request.POST)
           if form.is_valid():
               auth_login(request, form.get_user())    :  âœ… # auth_login : ì„¸ì…˜ì„ create í•˜ëŠ” í•¨ìˆ˜ = ì €ì¥í•˜ëŠ” í•¨ìˆ˜
               return redirect('posts:list')
               
       else:
           form = AuthenticationForm()   âœ…  # ë¡œê·¸ì¸í¼ = user ê°€ ì¡´ì¬í•˜ëŠ” ì§€ í™•ì¸ë§Œ í•˜ëŠ” form : ë”°ë¡œ save ì•ˆ í•¨
           
       return render(request, 'login.html', {'form': form})
   
   ```

   ```html
   <!-- login.html -->
   
   {% extends 'base.html' %}
   {% block container %}
   
   <h1>ë¡œê·¸ì¸</h1>
   <form method="post">
       {% csrf_token %}
       {{ form }}
       <input type="submit" value="Submit"/>
   </form>
   {% endblock %}
   ```

   ë¡œê·¸ì¸ í•œ ì‚¬ëŒ ìš°ì¸¡ ìƒë‹¨ì— ë³´ì—¬ì£¼ê¸° : crud - templates - base.html ìˆ˜ì •

   ```html
   <!-- base.html -->
   
   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <meta http-equiv="X-UA-Compatible" content="ie=edge">
       <title>Document</title>
   </head>
   <body>
       <h1> ë‚˜ëŠ” {{user.username}}  </h1>  <!-- í…œí”Œë¦¿ë³€ìˆ˜ ì•„ë‹ˆê³ , ì¥ê³ ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ê°€ì§€ê³  ìˆëŠ” ì •ë³´ -->
       {% block container %}
       {% endblock %}
   </body>
   </html>
   ```



3. ë¡œê·¸ì•„ì›ƒ

   ```python
   # urls.py
   
   from django.urls import path
   from . import views
   
   app_name = 'accounts'
   
   urlpatterns = [
       path('signup/', views.signup, name='signup'),
       path('login/', views.login, name='login'),
       path('logout/', views.logout, name='logout'),
       ]
   ```

   

   ```python
   # views.py
   
   from django.contrib.auth import logout as auth_logout
   
   def logout(request):
       auth_logout(request)
       return redirect('posts:list')
   ```



4. ìƒí™©ì— ë”°ë¼ ë‹¤ë¥¸ ë§í¬ë¥¼ ë³´ì—¬ì£¼ê¸°

   ex) ë¡œê·¸ì¸ ë˜ì–´ ìˆìœ¼ë©´, ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ë³´ì—¬ì£¼ê¸°

   â€‹      ë¡œê·¸ì•„ì›ƒ ë˜ì–´ ìˆìœ¼ë©´, ë¡œê·¸ì¸ ë²„íŠ¼ ë³´ì—¬ì£¼ê¸°

   â€‹      â†’ user ê°€ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ if ë¬¸ìœ¼ë¡œ

   ```html
   <!-- base.html -->
   
   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <meta http-equiv="X-UA-Compatible" content="ie=edge">
       <title>Document</title>
   </head>
   <body>
       {% if user.is_authenticated %}    âœ…
       
           <h1> ë‚˜ëŠ” {{user.username}}  <!-- í…œí”Œë¦¿ë³€ìˆ˜ ì•„ë‹ˆê³ , ì¥ê³ ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ê°€ì§€ê³  ìˆëŠ” ì •ë³´ -->
               <a href="{% url 'accounts:logout' %}">ë¡œê·¸ì•„ì›ƒ</a>
           </h1>
       
       {% else %}  âœ…
       
           <h1>
               <a href="{% url 'accounts:login' %}">ë¡œê·¸ì¸</a>
               <a href="{% url 'accounts:signup' %}">íšŒì›ê°€ì…</a>
           </h1>
       {% endif %}   âœ…
       
         
       {% block container %}
       {% endblock %}
   </body>
   </html>
   ```

   

   íšŒì›ê°€ì…í•˜ë©´, ë°”ë¡œ ë¡œê·¸ì¸ì´ ë˜ë„ë¡ views.py ìˆ˜ì •

   ```python
   def signup(request):
       if request.method == 'POST':
           form = UserCreationForm(request.POST)
           if form.is_valid():
               user = form.save()
               auth_login(request, user)  ğŸ‘ŒğŸ‘Œ # ì–˜ë§Œ ì¶”ê°€
               return redirect('posts:list')
           
       else:
           form = UserCreationForm()
               
       return render(request,'signup.html', {'form': form} )
       
   ```



â€‹	ë¡œê·¸ì¸ ë˜ì–´ ìˆìœ¼ë©´,   /accounts/login ë§í¬ë¡œ ë“¤ì–´ê°€ë”ë¼ë„, ë¡œê·¸ì¸ì°½ê³¼ íšŒì›ê°€ì…í˜ì´ì§€ ì•ˆ ë³´ì´ê²Œ

```python
# views.py

def signup(request):
    if request.user.is_authenticated: ğŸ‘ğŸ‘ğŸ‘ğŸ‘
        return redirect('posts:list') ğŸ‘ğŸ‘ğŸ‘ğŸ‘
        
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            auth_login(request, user)
            return redirect('posts:list')
        
    else:
        form = UserCreationForm()
            
    return render(request,'signup.html', {'form': form} )
    
============================================================
    
def login(request):
    if request.user.is_authenticated: ğŸ‘ğŸ‘ğŸ‘ğŸ‘
        return redirect('posts:list') ğŸ‘ğŸ‘ğŸ‘ğŸ‘
        
    if request.method == 'POST' :
        form = AuthenticationForm(request, request.POST)
        if form.is_valid():
            auth_login(request, form.get_user())
            return redirect('posts:list')
            
    else:
        form = AuthenticationForm()
        
    return render(request, 'login.html', {'form': form})
    
```



* ë¡œê·¸ì•„ì›ƒ í•˜ë©´, ê¸€ì“°ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°

  ```html
  # posts - templates - index.html ìˆ˜ì •
  
  {% extends 'base.html' %}
  {% load static %}
  {% block container %}
  
      <h1>Post Index</h1>
      
      {% if usef.is_authenticated %}   ğŸ‘ŒğŸ‘ŒğŸ‘Œ
          <a href="{% url 'posts:new' %}">ê¸€ì“°ê¸°</a> ğŸ‘ŒğŸ‘ŒğŸ‘Œ
      {% endif %}    ğŸ‘ŒğŸ‘ŒğŸ‘Œ
          
      <ul>
      {% for post in posts %}
          <li><a href="{% url 'posts:detail' post.pk %}">{{ post.title }}</a></li>
      {% endfor %}
      </ul>
  
  {% endblock %}
  
  ```

  ```python
  # ë¡œê·¸ì¸ ì•ˆ ë˜ì–´ ìˆìœ¼ë©´, ê¸€ì“°ê¸°ë§í¬(/posts/write) ì§ì ‘ì¹˜ë”ë¼ë„,  ë¡œê·¸ì¸ í•˜ë¼ê³ , ë¡œê·¸ì¸ ì°½ ë³´ì—¬ì¤Œ
  # posts- views.py
  
  from django.contrib.auth.decorators import login_required
  
  @login_required   # ì´ë ‡ê²Œ, í•¨ìˆ˜ ìœ„ì— ì¨ì§€ëŠ” í•¨ìˆ˜ë¥¼ decorator
                    	       # ì´ í•¨ìˆ˜ëŠ”, ì•„ë˜ ë¶™ì–´ìˆëŠ” í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤. ì¦‰ login_required(def new) 
                                # ì¦‰, ì•„ë˜ í•¨ìˆ˜ê°€ ì‹œí–‰í•˜ë ¤ë©´, ã…£ogin_required ê°€ ì¶©ì¡±ë˜ì–´ì•¼ í•˜ê³ , ì•ˆ ë˜ë©´ ë¡œê·¸ì¸í•˜ë¼ê³  í˜ì´ì§€ ëŒë ¤ì¤Œ ğŸ‘€ ( ê¸°ë³¸ê°’ì´    /accounts/login ìœ¼ë¡œ ë˜ì–´ ìˆìŒ)
          		  # ë¡œê·¸ì¸ ì•ˆ ëì„ ë•Œ, ë‚˜ì˜¤ëŠ” í˜ì´ì§€ ë‹¤ë¥¸ ê³³ìœ¼ë¡œ í•˜ê³  ì‹¶ìœ¼ë©´ 
              	        #  @ã…£ogin_required(login_url = '/asdf/dffff/')   ë­ ì´ë ‡ê²Œ ì“°ë©´ ë¨
  def new(request):
      if request.method == 'POST':
          # create
          title = request.POST.get('title')
          content = request.POST.get('content')
          image = request.FILES.get('image')
          post = Post(title=title, content=content, image=image)
          post.save()
          return redirect('posts:detail', post.pk)
          
      else:
          # new
          return render(request,'new.html')
  ```

* ë„˜ê²¨ì§„ ë¡œê·¸ì¸í˜ì´ì§€ì—ì„œ, ë¡œê·¸ì¸í•˜ë©´ ë°”ë¡œ ê¸€ì“°ê¸° í˜ì´ì§€ ë„ì›Œì£¼ê¸°

  ```python
  # views.py
  
  def login(request):
      if request.user.is_authenticated:
          return redirect('posts:list')
          
      if request.method == 'POST' :
          form = AuthenticationForm(request, request.POST)
          if form.is_valid():
              auth_login(request, form.get_user())
              return redirect(request.GET.get('next') or 'posts:list')
              
      else:
          form = AuthenticationForm()
      
      return render(request, 'login.html', {'form': form})
  ```

  ###### ì´ì´ë¯¸ì§€4 ë„£ê¸°

  