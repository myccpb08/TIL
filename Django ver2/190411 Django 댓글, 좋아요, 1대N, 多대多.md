# 1:N ëŒ“ê¸€ê¸°ëŠ¥

1. posts / models.py : ëŒ“ê¸€ê´€ë ¨ ìƒˆë¡œìš´ í…Œì´ë¸” ë§Œë“¤ê¸°

   ```python
   class Comment(models.Model): # 2ì¤‘ 1:N    [ê¸€ : ëŒ“ê¸€ì…ë ¥ì = ê¸€ : ëŒ“ê¸€ = 1:N]
       user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)   # foreignkey ì˜ ì²«ë²ˆì§¸ ì¸ì = ì–´ë–¤ í…Œì´ë¸”ê³¼ ê´€ê³„ë¥¼ ë§ºì„ ê²ƒì¸ì§€
                                                                                      # on_delete ì˜µì…˜ å¿…
       post = models.ForeignKey(Post, on_delete=models.CASCADE)
       content = models.TextField()
   ```

2. migration

   ```bash
   ./manage.py makemigrations
   ./manage.py migrate
   ```

3. forms.py

   ```python
   # ëŒ“ê¸€ form êµ¬í˜„í•˜ê¸°
   
   from .models import Post, Comment  # ì‚¬ìš©í•  table import í•˜ê¸°
   class CommentForm(forms.ModelForm):
       class Meta:
           model = Comment
           fields = ['content']
   ```

4. views.py í•¨ìˆ˜ ä½œ  (create ì™€ ìœ ì‚¬)

   ```python
   from django.views.decorators.http import require_POST 
   
   @login_required  # ë¡œê·¸ì¸ ë˜ì—ˆì„ ë•Œë§Œ ì•„ë˜ í•¨ìˆ˜ ì‹¤í–‰ ( ë§í¬ ì§ì ‘ ì…ë ¥í–ˆì„ ë•Œ ë°©ì§€ )
   @require_POST  # POSTìš”ì²­ìœ¼ë¡œ ë“¤ì–´ì™”ì„ ë•Œë§Œ ì•„ë˜ í•¨ìˆ˜ å¯
   def comment_create(request, post_id):  # íŠ¹ì • ê¸€ì— ëŒ“ê¸€ì„ ë‹¬ì•„ì•¼ í•˜ë‹ˆê¹Œ, post_id ë³€ìˆ˜ å¿…
       comment_form = CommentForm(request.POST) # ëŒ“ê¸€ì‘ì„±ì€ get ìš”ì²­ì´ í•„ìš”X âˆ´ ë”°ë¡œ ifë¬¸ í•„ìš” x
       if comment_form.is_valid():
           comment = comment_form.save(commit=False)
           comment.user = request.user
           comment.post_id = post_id
           comment.save()
       return redirect('posts:list') 
   # ëŒ“ê¸€ì„ ì‘ì„±í•˜ëŠ” í˜ì´ì§€ê°€ ë”°ë¡œ ìˆëŠ” ê±´ ì•„ë‹ˆê³ , í•´ë‹¹ ê¸€ ë°‘ì— ê·¸ëƒ¥ ì“°ëŠ” ê±°ë‹ˆê¹Œ ë”°ë¡œ í˜ì´ì§€ ë§Œë“¤ì§€ x
   ```

5. urls.py ë§í¬ ä½œ

   ```python
   path('<int:post_id>/comments/create/', views.comment_create, name='comment_create'),
   ```

6. views.py ì—ì„œ list í•¨ìˆ˜ ìˆ˜ì • ( ê¸€ ëª©ë¡ ë³´ì—¬ì£¼ëŠ” í˜ì´ì§€ì—ì„œ ëŒ“ê¸€ë„ ë³´ì—¬ì£¼ë ¤ê³ )

   ```python
   from .forms import PostForm, CommentForm
   
   def list(request):
       posts = Post.objects.order_by('-id').all()
       comment_form = CommentForm() âœ…
       return render(request,'posts/list.html', {'posts':posts,'comment_form':comment_form})âœ…
   ```

7. _post.html   (ë¦¬ìŠ¤íŠ¸ ë³´ì—¬ì£¼ëŠ” html íŒŒì¼ ìˆ˜ì •)

   ```html
   {% if post.image %}
     <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.image }}">
   {% endif %}
     <div class="card-body">
       <p class="card-text">{{ post.content }}</p>
       
       {% if post.user == user %}   <!-- == ë„ì–´ì¨ì•¼ í•¨ -->
       <a href="{% url 'posts:update' post.id %}" class="btn btn-primary">Edit</a>
       <a href="{% url 'posts:delete' post.id %}" class="btn btn-danger">Delete</a>
       {% endif %}
       
     </div>
     
   ğŸ‘€ğŸ“Œ ì—¬ê¸° ë°‘ì— ç­† (ë¶€íŠ¸ìŠ¤íŠ¸ë© ç”¨)
     <div class="card-body">
       {% for comment in post.comment_set.all %}
       <div class="card-text">
         <strong>{{ comment.user.username }}</strong>{{ comment.content }}
       </div>
       {% empty %}   <!-- html ì—ì„œë§Œ ì“¸ ìˆ˜ ìˆëŠ” ë¬¸ë²•. 
   				ë§Œì•½ post.comment_set.all ì´ ë¹„ì–´ìˆìœ¼ë©´(=ë°˜ë³µ ëŒë¦´ ê²ƒì´ ì—†ìœ¼ë©´) ì•„ë˜ êµ¬ë¬¸è¡Œ-->
         <div class="card-text">ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
       {% endfor %}
     </div>
     
     {% if user.is_authenticated %}  <!-- ë¡œê·¸ì¸ í–ˆì„ ë•Œë§Œ ëŒ“ê¸€ì‘ì„± ì°½ì„ ë³´ì—¬ì¤˜ -->
     <form action={% url 'posts:comment_create' post.id %} method="POST">
       {% csrf_token %}
       {{ comment_form }}
       <input type="submit" value="Submit"/>
     </form>
     {% endif %}
     
   </div>
   ```

8. forms.py ìˆ˜ì •

   ```python
   class CommentForm(forms.ModelForm):
       content = forms.CharField(label='', widget=forms.TextInput(attrs={'class':'form-control', 'placeholder':'ëŒ“ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”'}))  
       # í´ë˜ìŠ¤ 2ê°œ ë„£ê³  ì‹¶ìœ¼ë©´ ë„ì–´ì“°ê³  ì“°ë©´ ë¨ ex) 'class': 'form-control blue red'
       # form-control : form ì„ ì˜ˆì˜ê²Œ ê¾¸ë©° ì£¼ëŠ” 
       # attrs = attributes ì•½ì
       # models.py ì—ì„œ textfield ë¡œ ë§Œë“¤ì—ˆëŠ”ë°, ëŒ“ê¸€ì°½ì´ ë„ˆë¬´ ì»¤ì„œ ëª»ìƒê²¼ìœ¼ë‹ˆê¹Œ ì‘ê²Œ ë°”ê¿”ì£¼ëŠ” ì‘ì—…
       # í•œ ì¤„ ì§œë¦¬ input íƒœê·¸ë¡œ ë°”ë€œ
       # content ë¼ëŠ” ë¼ë²¨ë„ ì•ˆ ë³´ì„ (label='') ë•Œë¬¸ì—
       # charfield ëŠ” ì €ì¥í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ê¸¸ì´ê°€ ì œí•œë˜ì–´ ìˆìŒ âˆ´ ë³´ì—¬ì£¼ëŠ” ê±´ charfield ë¡œ ë³´ì—¬ì£¼ê³ 
       # ì‹¤ì œë¡œ ì €ì¥í•´ì£¼ëŠ” í˜•ì‹ì¸ models.py  ëŠ” textfield ë¡œ ë‚¨ê²¨ë‘ 
       class Meta:
           model = Comment
           fields = ['content']
   ```

9. ì œì¶œë²„íŠ¼ ê¾¸ë¯¸ê¸° (# bootstrap ì—ì„œ input group ê²€ìƒ‰í•˜ë©´ button addons ìˆìŒ (input ì˜¤ë¥¸ìª½ì— ì œì¶œë²„íŠ¼ ìˆëŠ” ê±°))

   ```html
   # _post.html
   {% if user.is_authenticated %}  <!-- ë¡œê·¸ì¸ í–ˆì„ ë•Œë§Œ ëŒ“ê¸€ì‘ì„± ì°½ì„ ë³´ì—¬ì¤˜ -->
     <form action={% url 'posts:comment_create' post.id %} method="POST">
       {% csrf_token %}
       
       <!-- bootstrapì—ì„œ input group å…§ button addons ìˆìŒ (input ì˜¤ë¥¸ìª½ì— ì œì¶œë²„íŠ¼ ìˆëŠ” ê±°)-->
       <div class="input-group">
       {{ comment_form }}
           <div class="input-group-append">
             <input type="submit" value="Submit" class="btn btn-primary"/>
           </div>
       </div>
   
     </form>
     {% endif %}
   ```

   

# ëŒ“ê¸€ì‚­ì œ

1. views.py

   ```python
   from django.views.decorators.http import require_POST, require_http_methods
   from .models import Post, Comment
   
   # a íƒœê·¸ëŠ” post ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ì—†ë‹¤. post ìš”ì²­ì€ form íƒœê·¸ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
   # post ìš”ì²­ ë°ì½”ë ˆì´í„° ì“°ë©´, ê·¸ëƒ¥ ì‚­ì œë²„íŠ¼ë§Œ ë§Œë“¤ì–´ë„ ë  ê±¸, form íƒœê·¸ë¡œ ë°”ê¿”ì¤˜ì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ ìˆìŒ
   # ê·¸ëŸ¬ë¯€ë¡œ, ê·¸ëƒ¥ get ìš”ì²­ ë“¤ì–´ê°€ë„ (a íƒœê·¸ì˜ href ëª©ì ì§€) ì‚­ì œ ë˜ë„ë¡ ì„¤ì •
   
   @require_http_methods(['GET','POST'])
   def comment_delete(request, post_id, comment_id): 
       # ì£¼ì†Œì“¸ ë•Œ, post_id ê°€ ë¨¼ì € ë“¤ì–´ê°€ë¯€ë¡œ ë³€ìˆ˜ ìˆœì„œ ì§€í‚¬ ê²ƒ
       comment = get_object_or_404(Comment, id=comment_id)
       if comment.user != request.user: # ëŒ“ê¸€ì˜ ì£¼ì¸ì´ ì•„ë‹ˆë©´
           return redirect('posts:list')  # ëª©ë¡ìœ¼ë¡œ ëŒë ¤ë³´ë‚´ë¼
           
       comment.delete()
       return redirect('posts:list')
   
   ```

2. urls.py

   ```python
   path('<int:post_id>/comments/<int:comment_id>/delete/', views.comment_delete, name='comment_delete'), 
   # ì–´ë–¤ ê²Œì‹œê¸€ì—, ëˆ„ê°€ ì“´ ëŒ“ê¸€ ì‚­ì œí•  ê²ƒì¸ì§€
   ```

3. _post.html  : ëŒ“ê¸€ ì˜†ì— ì‚­ì œë²„íŠ¼ ë§Œë“¤ê¸° (aíƒœê·¸ë¡œ)

   ```html
   <div class="card-text">
         <strong>{{ comment.user.username }}</strong>{{ comment.content }}
         {% if comment.user == user %}  <!-- ëŒ“ê¸€ ì£¼ì¸ê³¼, í˜„ì¬ ë¡œê·¸ì¸í•œ user ê°€ ê°™ìœ¼ë©´ -->
         <a href="{% url 'posts:commet_delete' post.id comment.id %}">ì‚­ì œ</a>  
       	<!-- ë„ì–´ì“°ê¸° ì§€ì¼œì•¼ -->
         {% endif %}
   </div> 
   ```

   

# ì¢‹ì•„ìš” ê¸°ëŠ¥ (å¤š : å¤š)

* User ëŠ” ì—¬ëŸ¬ê°€ì§€ ê¸€ì—, ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆê³ 

* í•˜ë‚˜ì˜ ê¸€ì— ì—¬ëŸ¬ user ê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆë‹¤ >> ì„œë¡œì„œë¡œ ì¢…ì† ê´€ê³„ê°€ ì•„ë‹ˆë‹¤

* ì¢‹ì•„ìš” ëˆ„ë¥¸ ì •ë³´ë¥¼ ë‹´ì„ ìƒˆë¡œìš´ í‘œê°€ í•„ìš”í•˜ë‹¤  (ê¸°ë¡ì¥ë¶€ ê°™ì€)

* ``` 
  post1  [p1, u1]  user1
  post2  [p1, u2]  user2
  post3  [p2, u2]  user3
  	   [p2, u3]
  ```

* ìš°ë¦¬ê°€ ì§ì ‘ ê¸°ë¡ì¥ë¶€ë¥¼ ë§Œë“¤ í•„ìš”ëŠ” ì—†ê³ , å¤š:å¤š ê´€ê³„ë¥¼ ì„ ì–¸ë§Œ í•´ì£¼ë©´, ì¥ê³ ê°€ ì•Œì•„ì„œ ë§Œë“¤ì–´ì¤ŒğŸ‘

1. models.py

   ```python
   class Post(models.Model):
       user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)                   content = models.TextField()
       image = ProcessedImageField(
           upload_to = post_image_path,
           processors=[ResizeToFill(600,600)],
           format = 'JPEG',
           options = {'quality':90},
           )
       
       like_users = models.ManyToManyField(settings.AUTH_USER_MODEL, related_name='like_posts')  
       # ì¢‹ì•„ìš” ëˆ„ë¥¸ user ë“¤
   ```

2. migrations í•˜ê¸°

3.  views.py

   ```python
   @login_required : # ë¡œê·¸ì¸ í•œ ì‚¬ëŒë§Œ ì¢‹ì•„ìš©â¤
   def like(request, post_id):
       post = get_object_or_404(Post, id=post_id)
       
       if request.user in post.like_users.all():   # -- all ë’¤ì— ê´„í˜¸ â­•
           						# postë¥¼ ì¢‹ì•„í•œ ì‚¬ëŒë“¤ å…§ í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ëŒì´ ìˆìœ¼ë©´
           post.like_users.remove(request.user)  # ì¢‹ì•„ìš” ì·¨ì†Œ
       
       else:
           post.like_users.add(request.user) # í˜„ì¬ ë¡œê·¸ì¸í•œ ìœ ì €ê°€ í•´ë‹¹ í¬ìŠ¤í„°ë¥¼ ì¢‹ì•„ìš” ëˆ„ë¥´ëŠ” í–‰ìœ„
        # post.like_users  (í¬ìŠ¤í„°ë¥¼ ì¢‹ì•„í•œ ìœ ì €ë“¤ ëª©ë¡ì—)  add(request.user) ë¡œê·¸ì¸í•œ user ë¥¼ ë”í•´
      
       return redirect('posts:list')
   ```

4. _post.html

   ````html
   <div class="card-body">
       <a href="{% url 'posts:like' post.id %}">
         {% if user in post.like_users.all %} <!-- ì¢‹ì•„ìš” ëˆŒë €ìœ¼ë©´ ê½‰ ì°¬ í•˜íŠ¸ -->
           								<!-- all ë’¤ì— ê´„í˜¸ âŒ -->
           <i class="fas fa-heart"></i>
         {% else %}  <!-- ì•„ë‹ˆë©´ -->
           <i class="far fa-heart"></i>  <!-- ë¹ˆ í•˜íŠ¸ -->
         {% endif %}
       </a>
       
       <p class="card-text">
         {{ post.like_users.count }} ëª…ì´ ì¢‹ì•„í•©ë‹ˆë‹¤
       </p>
   </div>
   ````

   

# ê°œì¸ í˜ì´ì§€ ë§Œë“¤ê¸°

1. accounts / views.py

   ```python
   from django.shortcuts import render, redirect, get_object_or_404
   from django.contrib.auth import get_user_model
   
   def people(request, username):
       # get_user_model()  #=> User,
       people = get_object_or_404(get_user_model(), username=username)  
       # ì• username=column, ë’¤ username = ì£¼ì†Œë¡œë¶€í„° ë„˜ê²¨ë°›ì€
       return render(request, 'accounts/people.html', {'people':people})
   ```

2. ì „ì²´ urls.py

   ```python
   from accounts import  views as accounts_views
   path('<str:username>/', accounts_views.people, name='people'),
   ```

3. accounts / people.html  (ä½œ)

   ```html
   {% extends 'base.html' %}
   
   {% block container %}
   
   <div class="container">
       <h1>{{ people.username }}</h1>
       <div class="row">
           {% for post in people.post_set.all %}
           <div class="col-4">
               <img src="{{ post.image.url }}" class="img-fluid"/>
           </div>
           {% endfor %}
       </div>
   </div>
   
   {% endblock %}
   
   ```

   +) ì¸ìŠ¤íƒ€ê·¸ë¨ ì•„ì´ì½˜ ëˆ„ë¥´ë©´, ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ê¸°

   ```html
   <!-- base.html -->
   <a class="navbar-brand" href="{% url 'posts:list' %}">
   
   ```

   